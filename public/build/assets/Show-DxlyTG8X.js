import{r as j,j as e,H as $,L as P,a as A}from"./app-CDLrXDSJ.js";import{A as T}from"./app-layout-RlSBJbLE.js";import{B as I}from"./button-DkAxeODS.js";import{C as m,a as x,b as h,c as u}from"./card-DSp6dVJs.js";import{B as v}from"./badge-Dv4yfngj.js";import{S as M,a as U,b as H,c as R,d as E}from"./select-CCjrtCIO.js";import{C as O}from"./checkbox-DSqH2tAu.js";import{L as V}from"./label-Bm7htFpx.js";import{S as G}from"./separator-Bk9qtVTf.js";import{A as z,a as W,b as J,c as Y,d as q,e as K,f as Q,g as X}from"./alert-dialog-SmhIjdbF.js";import{A as Z}from"./arrow-left-DmcQ2qpf.js";import{C as ee}from"./calendar-BQivIL1l.js";import{E as k}from"./external-link-DNBLhdcV.js";import{C as L,a as se}from"./copy-CrIN9RZ6.js";/* empty css            */import"./index-VGP26jel.js";import"./index-DMbkFXFE.js";import"./index-BJIqLsx3.js";import"./check-Cyaeh_xi.js";const te=[{title:"Form Entries",href:"/form-entries"},{title:"View",href:""}];function a(s,i){return i==null||i===""?null:e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx("span",{className:"text-sm",children:i})]})}function F(s,i){return!i||i.trim()===""?null:e.jsxs("div",{className:"space-y-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:s}),e.jsx("p",{className:"text-sm whitespace-pre-wrap break-words p-3 bg-muted rounded-lg",children:i})]})}function w(s){if(!s||s==="")return null;try{const i=JSON.parse(s);return!Array.isArray(i)||i.length===0?null:e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map((n,l)=>e.jsxs("a",{href:n.trim(),target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-500 flex gap-1 items-center hover:underline",children:["Image ",l+1," ",e.jsx(k,{className:"w-4 h-4"})]},l))})}catch{const n=s.split(",").filter(l=>l.trim()!=="");return n.length===0?null:e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map((l,d)=>e.jsxs("a",{href:l.trim(),target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-500 flex gap-1 items-center hover:underline",children:["Image ",d+1," ",e.jsx(k,{className:"w-4 h-4"})]},d))})}}function ae(s){if(!s||s==="")return null;const i=s.split(",").filter(n=>n.trim()!=="");return i.length===0?null:e.jsx("div",{className:"flex flex-wrap gap-1",children:i.map((n,l)=>e.jsx(v,{variant:"outline",children:n},l))})}function g(s){return s==="نعم"?"Yes":s==="لا"?"No":s||"N/A"}function re({need:s,familyId:i,entryId:n}){const l=s.pivot?.status||"pending",[d,b]=j.useState(l),[C,f]=j.useState(l==="given"),[_,t]=j.useState(!1),c=async o=>{t(!0);try{A.patch(`/form-entries/${n}/families/${i}/needs/${s.id}/status`,{status:o},{preserveScroll:!0,preserveState:!1,onSuccess:()=>{b(o),f(o==="given")},onError:p=>{console.error("Failed to update need status:",p),b(l),f(l==="given")}})}catch(p){console.error("Error updating need status:",p),b(l),f(l==="given")}finally{t(!1)}},r=o=>{const p=o?"given":"pending";f(o),c(p)},N=o=>{c(o)},S=o=>{switch(o){case"given":return e.jsx(v,{variant:"default",className:"bg-green-500 hover:bg-green-600",children:"Given"});default:return e.jsx(v,{variant:"secondary",children:"Pending"})}};return e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 hover:bg-muted rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx(O,{id:`need-${s.id}-${i}`,checked:C,onCheckedChange:r,disabled:_,className:"flex-shrink-0"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(V,{htmlFor:`need-${s.id}-${i}`,className:"text-sm font-medium cursor-pointer select-none",children:s.name_ar}),s.pivot?.notes&&e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.pivot.notes})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsxs(M,{value:d,onValueChange:N,disabled:_,children:[e.jsx(U,{className:"w-28 h-8 text-xs",children:e.jsx(H,{})}),e.jsxs(R,{children:[e.jsx(E,{value:"pending",children:"Pending"}),e.jsx(E,{value:"given",children:"Given"})]})]}),S(d),_&&e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})]})]})}function B(s,i,n){if(!s||s.length===0)return e.jsx("span",{className:"text-muted-foreground italic",children:"No needs"});const l=s.filter(d=>d.pivot?.status==="given"||d.pivot?.is_fulfilled).length;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 p-2 bg-muted rounded-lg",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:[e.jsx("strong",{children:l})," of ",e.jsx("strong",{children:s.length})," needs fulfilled"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-green-500 h-2 rounded-full transition-all duration-300",style:{width:`${s.length>0?l/s.length*100:0}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.length>0?Math.round(l/s.length*100):0,"%"]})]})]}),e.jsx("div",{className:"space-y-1",children:s.map(d=>e.jsx(re,{need:d,familyId:i,entryId:n},d.id))})]})}function we({entry:s,allNeeds:i,stats:n}){const[l,d]=j.useState(!1),[b,C]=j.useState(null),f=()=>{A.delete(`/form-entries/${s.id}`),d(!1)},_=async(t,c)=>{try{await navigator.clipboard.writeText(t),C(c),setTimeout(()=>C(null),2e3)}catch(r){console.error("Failed to copy text: ",r)}};return e.jsxs(T,{breadcrumbs:te,children:[e.jsx($,{title:`Entry ${s.entry_number||"N/A"}`}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 rounded-xl p-4 overflow-x-auto",children:[e.jsx("div",{className:"flex flex-col gap-4 sm:flex-row sm:justify-between sm:items-start",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(P,{href:"/form-entries",children:e.jsxs(I,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Z,{className:"w-4 h-4"}),"Back to Entries"]})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-muted rounded-lg",children:e.jsx(ee,{className:"w-6 h-6"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold tracking-tight",children:["Entry #",s.entry_number||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsxs(v,{variant:"outline",className:"gap-1",children:[n.total_displaced_families," families"]}),e.jsxs(v,{variant:"outline",children:[n.total_needs," total needs"]}),e.jsxs(v,{variant:"outline",className:"bg-green-500 hover:bg-green-600",children:[n.fulfilled_needs," fulfilled"]})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsxs(m,{children:[e.jsx(x,{className:"border-b",children:e.jsx(h,{className:"text-lg font-semibold",children:"Entry Details"})}),e.jsxs(u,{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[a("Form ID",s.form_id),a("Entry Number",s.entry_number),a("Submitter Name",s.submitter_name),a("Location",s.location),s.status&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx("div",{children:ae(s.status)})]})]}),e.jsxs("div",{className:"space-y-4",children:[s.InternalLink&&e.jsxs("div",{className:"flex justify-between items-center py-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Internal Link"}),e.jsxs("a",{href:s.InternalLink,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-500 flex gap-1 items-center hover:underline",children:["View Form ",e.jsx(k,{className:"w-4 h-4"})]})]}),a("Date Submitted",s.date_submitted?new Date(s.date_submitted).toLocaleString():null),a("Hosted Families Count",s.hosted_families_count),a("Martyrs Count",s.martyrs_count),a("Shelters Count",s.shelters_count)]})]}),s.notes&&F("Entry Notes",s.notes)]})]}),s.host&&s.host.full_name&&e.jsxs(m,{children:[e.jsx(x,{className:"border-b",children:e.jsx(h,{className:"text-lg font-semibold",children:"Host Information"})}),e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[a("Full Name",s.host.full_name),a("Family Count",s.host.family_count),a("Location",s.host.location),a("Address",s.host.address),a("Phone",s.host.phone)]}),e.jsxs("div",{className:"space-y-4",children:[a("Family Book Number",s.host.family_book_number),a("Children Under 8 Months",g(s.host.children_under_8_months)),s.host.children_under_8_months==="نعم"&&a("Birth Details",s.host.birth_details)]})]})})]}),s.displacedFamilies&&s.displacedFamilies.length>0&&e.jsxs(m,{children:[e.jsx(x,{className:"border-b",children:e.jsxs(h,{className:"text-lg font-semibold",children:["Displaced Families (",s.displacedFamilies.length,")"]})}),e.jsx(u,{className:"p-6 space-y-6",children:s.displacedFamilies.map((t,c)=>e.jsxs(m,{className:"border",children:[e.jsx(x,{className:"bg-muted",children:e.jsxs(h,{className:"text-md",children:["Family ",c+1]})}),e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[a("Individuals Count",t.individuals_count),a("Contact",t.contact),a("Wife Name",t.wife_name),a("Children Info",t.children_info),a("Family Book Number",t.family_book_number),a("Assistance Type",t.assistance_type),a("Provider",t.provider),a("Date Received",t.date_received)]}),e.jsxs("div",{className:"space-y-4",children:[a("Return Possible",g(t.return_possible)),a("Previous Assistance",g(t.previous_assistance)),a("Children Under 8 Months",g(t.children_under_8_months)),t.children_under_8_months==="نعم"&&a("Birth Details",t.birth_details),t.images&&e.jsxs("div",{className:"flex justify-between items-start py-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Images"}),e.jsx("div",{children:w(t.images)})]})]})]}),t.notes&&e.jsx("div",{className:"mt-4",children:F("Family Notes",t.notes)}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Current Needs"}),B(t.needs,t.id,s.id)]})]})]},t.id))})]}),s.martyrs&&s.martyrs.filter(t=>t.name).length>0&&e.jsxs(m,{children:[e.jsx(x,{className:"border-b",children:e.jsxs(h,{className:"text-lg font-semibold",children:["Martyrs (",s.martyrs.filter(t=>t.name).length,")"]})}),e.jsx(u,{className:"p-6 space-y-4",children:s.martyrs.filter(t=>t.name).map((t,c)=>e.jsxs(m,{className:"border",children:[e.jsx(x,{className:"bg-muted",children:e.jsxs(h,{className:"text-md",children:["Martyr ",c+1]})}),e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[a("Name",t.name),a("Age",t.age),a("Place of Martyrdom",t.place)]}),e.jsxs("div",{className:"space-y-4",children:[a("Relative Contact",t.relative_contact),t.image&&e.jsxs("div",{className:"flex justify-between items-start py-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Images"}),e.jsx("div",{children:w(t.image)})]})]})]})})]},t.id))})]}),s.shelters&&s.shelters.filter(t=>t.place||t.contact||t.displacedFamilies&&t.displacedFamilies.length>0).length>0&&e.jsxs(m,{children:[e.jsx(x,{className:"border-b",children:e.jsxs(h,{className:"text-lg font-semibold",children:["Shelters (",s.shelters.filter(t=>t.place||t.contact||t.displacedFamilies&&t.displacedFamilies.length>0).length,")"]})}),e.jsx(u,{className:"p-6 space-y-6",children:s.shelters.filter(t=>t.place||t.contact||t.displacedFamilies&&t.displacedFamilies.length>0).map((t,c)=>e.jsxs(m,{className:"border",children:[e.jsx(x,{className:"bg-muted",children:e.jsxs(h,{className:"text-md",children:["Shelter ",c+1]})}),e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"space-y-4",children:[a("Place",t.place),a("Contact",t.contact)]}),e.jsx("div",{className:"space-y-4",children:t.images&&e.jsxs("div",{className:"flex justify-between items-start py-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Images"}),e.jsx("div",{children:w(t.images)})]})})]}),t.displacedFamilies&&t.displacedFamilies.length>0&&e.jsxs("div",{className:"border-t pt-6",children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-4",children:["Families in Shelter (",t.displacedFamilies.length,")"]}),t.displacedFamilies.map((r,N)=>e.jsxs(m,{className:"mt-4 mb-4 bg-muted border",children:[e.jsx(x,{children:e.jsxs(h,{className:"text-md",children:["Family ",N+1]})}),e.jsxs(u,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[a("Individuals Count",r.individuals_count),a("Contact",r.contact),a("Wife Name",r.wife_name),a("Children Info",r.children_info),a("Family Book Number",r.family_book_number),a("Assistance Type",r.assistance_type),a("Provider",r.provider),a("Date Received",r.date_received)]}),e.jsxs("div",{className:"space-y-4",children:[a("Return Possible",g(r.return_possible)),a("Previous Assistance",g(r.previous_assistance)),a("Children Under 8 Months",g(r.children_under_8_months)),r.children_under_8_months==="نعم"&&a("Birth Details",r.birth_details),r.images&&e.jsxs("div",{className:"flex justify-between items-start py-2",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Images"}),e.jsx("div",{children:w(r.images)})]})]})]}),r.notes&&e.jsx("div",{className:"mt-4",children:F("Family Notes",r.notes)}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Current Needs"}),B(r.needs,r.id,s.id)]})]})]},r.id))]})]})]},t.id))})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs(m,{children:[e.jsx(x,{className:"border-b",children:e.jsx(h,{className:"text-lg font-semibold",children:"Entry Summary"})}),e.jsx(u,{className:"p-6 space-y-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Form ID"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:s.form_id||"N/A"}),s.form_id&&e.jsx(I,{variant:"ghost",size:"sm",onClick:()=>_(s.form_id||"","form_id"),className:"h-6 w-6 p-0",children:b==="form_id"?e.jsx(L,{className:"w-3 h-3 text-green-600"}):e.jsx(se,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Entry Number"}),e.jsx("span",{className:"text-sm",children:s.entry_number||"N/A"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Submitter"}),e.jsx("span",{className:"text-sm",children:s.submitter_name||"N/A"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"Location"}),e.jsx("span",{className:"text-sm",children:s.location||"N/A"})]}),e.jsx(G,{})]})})]}),i&&i.length>0&&e.jsxs(m,{children:[e.jsx(x,{className:"border-b",children:e.jsxs(h,{className:"text-lg font-semibold",children:["All Needs (",i.length,")"]})}),e.jsx(u,{className:"p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:i.map(t=>{const[c,r]=j.useState(!1),[N,S]=j.useState(t.pivot?.status||"pending"),o=N==="given"||t.pivot?.is_fulfilled,p=async()=>{r(!0);const D=N==="given"?"pending":"given";try{A.patch(route("entries.update-need-status",{entry:s.id,family:0,need:t.id}),{status:D},{preserveScroll:!0,preserveState:!1,onSuccess:()=>{S(D)},onFinish:()=>{r(!1)}})}catch(y){console.error("Error:",y),r(!1)}};return e.jsxs("button",{onClick:p,disabled:c,className:`flex items-center gap-2 p-3 rounded-lg border cursor-pointer transition-all text-left ${o?"bg-green-50 border-green-200 text-green-800 hover:bg-green-100":"bg-muted border-border text-foreground hover:bg-muted/50"} ${c?"opacity-50 cursor-not-allowed":""}`,children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${o?"bg-green-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium flex-1",children:t.name_ar}),e.jsxs("div",{className:"flex items-center gap-1",children:[o&&e.jsx(L,{className:"w-4 h-4 text-green-600"}),c&&e.jsx("div",{className:"w-4 h-4 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"})]})]},t.id)})})})]})]})]})]}),e.jsx(z,{open:l,onOpenChange:d,children:e.jsxs(W,{children:[e.jsxs(J,{children:[e.jsx(Y,{children:"Are you sure?"}),e.jsx(q,{children:"This action cannot be undone. This will permanently delete this entry and all associated data."})]}),e.jsxs(K,{children:[e.jsx(Q,{children:"Cancel"}),e.jsx(X,{onClick:f,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete Entry"})]})]})})]})}export{we as default};
