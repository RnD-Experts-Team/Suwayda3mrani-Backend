import{r as o,a as u,j as e,H as he,L as p}from"./app-DN9RV__Q.js";import{A as xe,B as fe}from"./app-layout-DxMtDWRq.js";import{B as l}from"./button-D_5DhwUH.js";import{I as pe}from"./input-eiE76Ome.js";import{S as ge,a as je,b as Ne,c as ve,d as S}from"./select-2x8orbPI.js";import{B as y}from"./badge-D2O2XcS6.js";import{C as g,a as Se,b as ye,c as j}from"./card-j2w5etHN.js";import{C as H}from"./checkbox-sC94O9Lg.js";import{A as R,a as z,b as L,c as V,d as q,e as U,f as J,g as W}from"./alert-dialog-BPpXFtg3.js";import{P as be,a as we,b as _e,c as Ce,d as De,e as ke}from"./pagination-CZBeRXT3.js";import{T as b}from"./trash-2-oCGTL2PG.js";import{P as G}from"./plus-BAal3wXV.js";import{F as Ie}from"./filter-DogY7sN0.js";import{R as K}from"./rotate-ccw-IGtuB2Qi.js";import{S as M}from"./search-CBZKAniG.js";import{S as Ae,a as Fe}from"./star-nUbUpBAR.js";import{H as Q}from"./heart-DhDHe_ux.js";import{E as Te}from"./eye-By_9mHMC.js";import{S as Pe}from"./square-pen-CVlgGcg6.js";/* empty css            */import"./index-C6nulwC9.js";import"./index-DiJLFeac.js";import"./index-CdGWDYG6.js";import"./check-BlzswjXE.js";import"./chevron-left-CcAsyhWj.js";const Oe=[{title:"Stories of Hope",href:"/stories"}];function is(w){console.log("Stories Props Received:",w);const{stories:n=null,filters:X=null}=w||{},Y=s=>{if(typeof s=="string")try{const t=JSON.parse(s);return console.log("Parsed translated content:",t),t}catch(t){return console.error("Error parsing translated content:",t,"Raw content:",s),{title:{en:"Untitled Story",ar:"قصة بدون عنوان"},description:{en:"No description",ar:"لا يوجد وصف"},backgroundImage:null,url:""}}return s||{title:{en:"Untitled Story",ar:"قصة بدون عنوان"},description:{en:"No description",ar:"لا يوجد وصف"},backgroundImage:null,url:""}},Z=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(t){return console.error("Error parsing links:",t),[]}return Array.isArray(s)?s:[]},r={data:n?.data||[],links:Z(n?.links||[]),meta:{current_page:n?.meta?.current_page||1,last_page:n?.meta?.last_page||1,total:n?.meta?.total||0,per_page:n?.meta?.per_page||12,from:n?.meta?.from||null,to:n?.meta?.to||null}},_=X||{},[d,C]=o.useState(_.search||""),[x,D]=o.useState(_.featured||"__all__"),[i,h]=o.useState([]),[ee,N]=o.useState(!1),[se,v]=o.useState(!1),[k,I]=o.useState(null),[te,ae]=o.useState(!0);o.useEffect(()=>{if(te){ae(!1);return}const s=setTimeout(()=>{F()},300);return()=>clearTimeout(s)},[d]);const A=s=>s==="__all__"?"":s,F=()=>{const s={};d?.trim()&&(s.search=d.trim());const t=A(x);t&&(s.featured=t),u.get("/stories",Object.keys(s).length>0?s:{},{preserveState:!0,preserveScroll:!0})},re=(s={})=>{const t={},a=s.search!==void 0?s.search:d,c=s.featured!==void 0?s.featured:x;a?.trim()&&(t.search=a.trim());const E=A(c);E&&(t.featured=E),u.get("/stories",Object.keys(t).length>0?t:{},{preserveState:!0,preserveScroll:!0})},T=()=>{C(""),D("__all__"),u.get("/stories")},le=s=>{s&&r.data.length>0?h(r.data.map(t=>t.id)):h([])},ie=(s,t)=>{h(t?a=>[...a,s]:a=>a.filter(c=>c!==s))},ne=s=>{I(s),N(!0)},oe=()=>{k&&u.delete(`/stories/${k}`),N(!1),I(null)},P=()=>{v(!0)},ce=()=>{i.length>0&&u.post("/stories/bulk-delete",{ids:i}),v(!1),h([])},de=s=>{u.patch(`/stories/${s.id}/toggle-featured`,{},{preserveState:!0,preserveScroll:!0})},m=!!(d?.trim()||x!=="__all__"),O=r.data.length===0||r.meta.total===0,f=r.meta.total,B=r.meta.from,$=r.meta.to,me=()=>O&&!m?"No stories found. Create your first story of hope to get started.":O&&m?"No results match your current filters.":B&&$?`Showing ${B} to ${$} of ${f} results`:f>0?`${f} stor${f!==1?"ies":"y"}`:"Loading stories...",ue=()=>e.jsx(g,{className:"overflow-hidden",children:e.jsx(j,{className:"py-16",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-muted rounded-full flex items-center justify-center",children:e.jsx(Q,{className:"w-8 h-8 text-muted-foreground"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-lg font-semibold",children:m?"No stories found":"No stories of hope yet"}),e.jsx("p",{className:"text-muted-foreground max-w-md mx-auto",children:m?"Try adjusting your filters to find what you're looking for.":"Create your first story of hope to inspire others and share positive impact."})]}),e.jsxs("div",{className:"flex justify-center gap-2 pt-4",children:[m&&e.jsxs(l,{variant:"outline",onClick:T,className:"gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Clear Filters"]}),e.jsx(p,{href:"/stories/create",children:e.jsxs(l,{className:"gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Create Story"]})})]})]})})});return e.jsxs(xe,{breadcrumbs:Oe,children:[e.jsx(he,{title:"Stories of Hope"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4 overflow-x-auto",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:justify-between sm:items-center",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Stories of Hope"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:me()})]}),e.jsxs("div",{className:"flex gap-2",children:[i.length>0&&e.jsxs(l,{variant:"destructive",onClick:P,size:"sm",className:"gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Delete Selected (",i.length,")"]}),e.jsx(p,{href:"/stories/create",children:e.jsxs(l,{size:"sm",className:"gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),"Create Story"]})})]})]}),e.jsxs(g,{className:"overflow-hidden",children:[e.jsx(Se,{className:"px-6 py-4 border-b",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-muted-foreground"}),e.jsx(ye,{className:"text-lg font-semibold",children:"Filters"})]}),m&&e.jsxs(l,{variant:"outline",size:"sm",onClick:T,className:"gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"Clear Filters"]})]})}),e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(pe,{type:"text",placeholder:"Search stories...",value:d,onChange:s=>C(s.target.value),className:"pl-10"})]}),e.jsxs(ge,{value:x,onValueChange:s=>{D(s),re({featured:s})},children:[e.jsx(je,{children:e.jsx(Ne,{placeholder:"All Stories"})}),e.jsxs(ve,{children:[e.jsx(S,{value:"__all__",children:"All Stories"}),e.jsx(S,{value:"true",children:"Featured Only"}),e.jsx(S,{value:"false",children:"Not Featured"})]})]}),e.jsxs(l,{onClick:F,className:"gap-2",children:[e.jsx(M,{className:"w-4 h-4"}),"Search"]})]})})]}),r.data.length===0?e.jsx(ue,{}):e.jsxs(e.Fragment,{children:[i.length>0&&e.jsx(g,{children:e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{checked:i.length===r.data.length&&r.data.length>0,onCheckedChange:le}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[i.length," of ",r.data.length," selected"]})]}),e.jsxs(l,{variant:"destructive",size:"sm",onClick:P,className:"gap-2",children:[e.jsx(b,{className:"w-4 h-4"}),"Delete Selected"]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.data.map((s,t)=>{console.log(`Rendering story ${t+1}:`,s.id,s.story_id);const a=Y(s.translated_content);return console.log(`Story ${s.id} translated content:`,a),e.jsxs(g,{className:"overflow-hidden group",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-3 left-3 z-10",children:e.jsx(H,{checked:i.includes(s.id),onCheckedChange:c=>ie(s.id,!!c)})}),e.jsx("button",{onClick:()=>de(s),className:"absolute top-3 right-3 z-10 p-1 rounded-full bg-black/50 text-white opacity-0 group-hover:opacity-100 transition-opacity",children:s.is_featured?e.jsx(Ae,{className:"w-4 h-4 fill-yellow-400 text-yellow-400"}):e.jsx(Fe,{className:"w-4 h-4"})}),e.jsx("div",{className:"aspect-[4/3] bg-muted flex items-center justify-center",children:a.backgroundImage?e.jsx("img",{src:a.backgroundImage,alt:a.title?.en||"Story image",className:"w-full h-full object-cover",onError:c=>{console.error("Image failed to load:",a.backgroundImage),c.currentTarget.style.display="none"}}):e.jsxs("div",{className:"flex flex-col items-center gap-2 text-muted-foreground",children:[e.jsx(fe,{className:"w-8 h-8"}),e.jsx("span",{className:"text-xs",children:"No image"})]})}),e.jsx("div",{className:"absolute bottom-3 left-3",children:e.jsxs(y,{variant:"secondary",className:"gap-1",children:[e.jsx(Q,{className:"w-3 h-3"}),"Hope Story"]})})]}),e.jsx(j,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-2",children:a.title?.en||s.story_id||"Untitled Story"}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-1",dir:"rtl",children:a.title?.ar||"قصة بدون عنوان"}),e.jsx("p",{className:"text-xs text-muted-foreground line-clamp-3",children:a.description?.en||"No description"}),e.jsxs("div",{className:"space-y-1",children:[s.media_count>0&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.media_count," media item",s.media_count!==1?"s":""]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Story ID: ",s.story_id]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Created: ",new Date(s.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-2",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p,{href:`/stories/${s.id}`,children:e.jsx(l,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Te,{className:"w-4 h-4"})})}),e.jsx(p,{href:`/stories/${s.id}/edit`,children:e.jsx(l,{variant:"outline",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(Pe,{className:"w-4 h-4"})})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>ne(s.id),className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:e.jsx(b,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex gap-1",children:[s.is_featured&&e.jsx(y,{variant:"default",className:"text-xs",children:"Featured"}),!s.is_active&&e.jsx(y,{variant:"secondary",className:"text-xs",children:"Inactive"})]})]})]})})]},s.id)})}),r.meta.last_page>1&&e.jsx("div",{className:"flex justify-center",children:e.jsx(be,{children:e.jsx(we,{children:r.links.map((s,t)=>e.jsx(_e,{children:s.label==="&laquo; Previous"?e.jsx(Ce,{href:s.url||"#",className:s.url?"":"pointer-events-none opacity-50"}):s.label==="Next &raquo;"?e.jsx(De,{href:s.url||"#",className:s.url?"":"pointer-events-none opacity-50"}):e.jsx(ke,{href:s.url||"#",isActive:s.active,className:s.url?"":"pointer-events-none opacity-50",children:s.label})},t))})})})]})]}),e.jsx(R,{open:ee,onOpenChange:N,children:e.jsxs(z,{children:[e.jsxs(L,{children:[e.jsx(V,{children:"Are you sure?"}),e.jsx(q,{children:"This action cannot be undone. This will permanently delete the story and all associated content."})]}),e.jsxs(U,{children:[e.jsx(J,{children:"Cancel"}),e.jsx(W,{onClick:oe,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete"})]})]})}),e.jsx(R,{open:se,onOpenChange:v,children:e.jsxs(z,{children:[e.jsxs(L,{children:[e.jsxs(V,{children:["Delete ",i.length," stories?"]}),e.jsx(q,{children:"This action cannot be undone. This will permanently delete the selected stories and all associated content."})]}),e.jsxs(U,{children:[e.jsx(J,{children:"Cancel"}),e.jsx(W,{onClick:ce,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Delete All"})]})]})})]})}export{is as default};
